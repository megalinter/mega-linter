descriptor_id: ARM
descriptor_type: tooling_format
file_extensions:
  - ".json"
file_contains:
  - "schema.management.azure.com"
linters:
  # ARM TTK
  - class: ArmLinter
    linter_name: arm-ttk
    linter_url: https://github.com/Azure/arm-ttk
    linter_rules_configuration_url: https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/test-toolkit#customize-tests
    config_file_name: .arm-ttk.psd1
    linter_version_cache: "0.0.0"  # TODO: retrieve arm-ttk version
    examples:
      - |
        pwsh -NoProfile -NoLogo -Command "
            Import-Module /usr/bin/arm-ttk;
            Test-AzTemplate -TemplatePath myfile.json;
            if (${Error}.Count) {exit 1}"
            "
      - |
        "pwsh -NoProfile -NoLogo -Command "
            Import-Module /usr/bin/arm-ttk;
            ${config} = $(Import-PowerShellDataFile -Path ".arm-ttk.psd1");
            Test-AzTemplate @config -TemplatePath myfile.json;
            if (${Error}.Count) {exit 1}
            "
    install:
      dockerfile:
        - |
          RUN curl --retry 5 --retry-delay 5 -sLO "https://github.com/Azure/arm-ttk/archive/master.zip" \
              && unzip "master.zip" -d "/opt/microsoft" \
              && rm "master.zip" \
              && ln -sTf "/opt/microsoft//arm-ttk-master/arm-ttk/arm-ttk.psd1" /usr/bin/arm-ttk \
              && chmod a+x /usr/bin/arm-ttk
    ide:
      vscode:
        - name: ARMTTKExtension
          url: https://marketplace.visualstudio.com/items?itemName=Sam-Cogan.ARMTTKExtension