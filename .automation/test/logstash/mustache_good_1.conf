# Sample Logstash configuration for creating a simple
# Beats -> Logstash -> Elasticsearch pipeline.

input {
  beats {
    port => 5044
  }

  http {
    # Useful to push some events over REST/JSON
    id => "http"
    port => 8080
    tags => ["http"]
    additional_codecs => {
      "application/json"=>"json"
      "application/json; charset=utf-8"=>"json"
      "application/json; charset=UTF-8"=>"json"
    }
  }

  tcp {
    port => 8090
    codec => "json_lines"
    tags => ["tcp"]
  }
}

filter {
  if "http" in [tags] and ! [http_feed_type] {
    # Detect http feed type using the base URI path (without querystring)
    # Only do this if http_feed_type isn't already provided in the feed
    grok {
      match => {
        "[headers][request_path]" => "^/?%{DATA:http_feed_type}/?(\?.*)?$"
      }
    }
  }
}

output {
  if "_grokparsefailure" in [tags] or "_rubyexception" in [tags] or "_jsonparsefailure" in [tags] or "_dateparsefailure"  in [tags] {
    stdout {
      codec => rubydebug
    }
  }
}
